# Домашнее задание к занятию `«13.Системы мониторинга»` - Пугач Евгений.


---

## `Задание 1`

   Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект  
представляет из себя платформу для вычислений с выдачей текстовых отчётов, которые сохраняются на диск.  
Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления  
загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?

### Ответ:

Я бы порекомендовал мониторить следующие метрики:
  - Загруженность процессора (CPU LA)
  - Нагрузка на диски (число операций в секунду ` IOPS `, процессорное ожидание ввода/вывода ` iowait `,  
  время отклика ` latency `, индексные дескрипторы ` inodes`)
  - Использование RAM `(RAM/swap)`
  - Нагрузка на API (доступность сервиса, мониторинг количества ошибочных ответов, время ответа)
  - Нагрузка на сеть

---

## `Задание 2`

   Менеджер продукта, посмотрев на ваши метрики, сказал, что ему непонятно, что такое RAM/inodes/CPUla.  
Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество  
обслуживания. Что вы можете ему предложить?

### Ответ:

   Я бы предложил сравнивать целевые и текущие показатели производительности.  
Для опредения качества обслуживания можно рассчитать следующие индикаторы:  
  - процент ошибочных ответов (не подготовленных отчетов)  
  - минимальное, среднее и максимальное время ожидания ответа в API (время подготовки отчета)  
  - общее время/процент недоступности сервиса за период времени (контрактный период).  

   А для того, чтобы привести метрики в более простой и читаемый вид для менеджеров, необходимо утвердить SLA,  
в рамках которого будут указаны SLO для тех или иных метрик. После чего менеджерам будет проще ориентироваться  
в состоянии продукта, потому что их будут интересовать только разницы значений SLO и SLI. Если значения SLI той или  
иной метрики не противоречат установленным для неё SLO, тогда проект в норме. Это позволит менеджеру не знать,  
для чего та или иная метрика, но позволит им сложить общую картину состояния работоспособности проекта.
 
---

## `Задание 3`

   Вашей DevOps-команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики,  
в свою очередь, хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой  
ситуации, чтобы разработчики получали ошибки приложения?

### Ответ:

   Я бы предложил использовать средство перехвата ошибок Sentry и систему сбора метрик Prometheus. Есть большое  
количество библиотек с исходным кодом, для удобного встраивания в проекты, практически на любом языке. Для экономии  
ресурсов, можно уменьшить глубину хранения ошибок и метрик.

---

## `Задание 4`

   Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA = 99% по http-кодам ответов.  
Этот параметр вычисляется по формуле: summ_2xx_requests/summ_all_requests. Он не поднимается выше 70%, но при этом  
в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

### Ответ:

   Вероятно ошибка в том, что в формуле не используются значения кодов 1xx(informational) и 3xx(redirectional).  
Правильный вариант формулы будет выглядеть так:  

   ` (summ_1xx_requests + summ_2xx_requests + summ_3xx_requests)/summ_all_requests `

---

## `Задание 5`

   Опишите основные плюсы и минусы pull и push систем мониторинга.

### Ответ:

### `Push-модель`

    Плюсы:

    - упрощение репликации данных в разные системы мониторинга или их резервные копии
    - более гибкая настройка отправки пакетов данных с метриками
    - UDP — это менее затратный способ передачи данных, из-за чего может возрасти производительность  
    сбора метрик

    Минусы:

    - UDP не гарантирует доставку данных
    - Необходимость проверки подлинности данных

### `Pull-модель`

    Плюсы:

    - легче контролировать подлинность данных
    - можно настроить единый proxy server до всех агентов с TLS
    - упрощённая отладка получения данных с агентов

    Минусы:

    - oткрытие порта для сбора метрик на каждом узле
    - ведение списка узлов для мониторинга

---

## `Задание 6`

    Какие из ниже перечисленных систем относятся к push модели, а какие к pull? А может есть гибридные?

### Ответ:

    - `Prometheus` - основной pull (push с помощью Pushgateway)
    - `TICK` - основной push
    - `Zabbix` - push и pull
    - `VictoriaMetrics` - push и pull
    - `Nagios` - основной pull (push с помощью плагина)

---

## `Задание 7`

   Склонируйте себе репозиторий и запустите TICK-стэк, используя технологии docker и docker-compose.  
   В виде решения на это упражнение приведите скриншот веб-интерфейса ПО chronograf (http://localhost:8888).

### Ответ:

![Скриншот 1](https://github.com/PugachEV72/Images/blob/master/2024-02-18_19-33-49.png)

---

## `Задание 8`

   Перейдите в веб-интерфейс Chronograf (http://localhost:8888) и откройте вкладку Data explorer. Нажмите на  
кнопку Add a query. Изучите вывод интерфейса и выберите БД telegraf.autogen. В measurments выберите  
cpu->host->telegraf-getting-started, а в fields выберите usage_system. Внизу появится график утилизации cpu.  
Вверху вы можете увидеть запрос, аналогичный SQL-синтаксису. Поэкспериментируйте с запросом, попробуйте  
изменить группировку и интервал наблюдений. Для выполнения задания приведите скриншот с отображением метрик  
утилизации cpu из веб-интерфейса.

### Ответ:

![Скриншот 2](https://github.com/PugachEV72/Images/blob/master/2024-02-18_19-52-46.png)

---

## `Задание 9`

Изучите список telegraf inputs. Добавьте в конфигурацию telegraf следующий плагин - docker.

![Скриншот 3](https://github.com/PugachEV72/Images/blob/master/2024-02-18_20-04-47.png)

---

Дополнительно вам может потребоваться донастройка контейнера telegraf в docker-compose.yml дополнительного volume  
и режима privileged.

![Скриншот 4](https://github.com/PugachEV72/Images/blob/master/2024-02-18_21-35-09.png)

![Скриншот 5](https://github.com/PugachEV72/Images/blob/master/2024-02-18_21-36-03.png)

---

После настройкb перезапустите telegraf, обновите веб интерфейс и приведите скриншотом список measurments  
в веб-интерфейсе базы telegraf.autogen. Там должны появиться метрики, связанные с docker.

### Ответ:

![Скриншот 6](https://github.com/PugachEV72/Images/blob/master/2024-02-18_21-32-16.png)

---



